<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <link rel="stylesheet" href="/css/font.css" type="text/css">
    <link rel="stylesheet" href="/css/xadmin.css" type="text/css">
    <link rel="stylesheet" href="/css/personal.css" type="text/css">
    <script src="/js/jquery.min.js"></script>
    <script src="/lib/layui/layui.js"></script>
    <script type="text/javascript" src="/js/xadmin.js"></script>

    <!-- 导入地址-->
    <link rel="stylesheet" href="/lib/layui/css/layui.css"/>

    <!--[if lt IE 9]>
    <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
    <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <title>个人信息</title>
    <style>
        table {
            border:2px;
            border-color: #E6E6E6;
            margin-top:50px;
            margin-left: 150px;
            display: block;
            font-size: 18px;
            font-family: '宋体';
            color:#595959;
            text-align: center;
        }
        tbody tr {
            display: inline-block;
        }
        th, td {
            width:200px;
            height: 40px;
            display: block;
        }
        th{
            width: 200px;
            height: 40px;
            display: block;
        }
        button{
            width:100px;
            height:30px;
            font-size: 18px;
            background-color:#009688 ;
            color: white;
            border:none;
            border-radius: 10px;
        }
        .layui-form{
            margin-top: 30px;
            margin-left: 50px;
        }
    </style>
</head>
<body>
<div class="x-nav">
              <span class="layui-breadcrumb">
                <a href="">首页</a>
                <a href="">业务查询</a>
                <a>
                  <cite>个人信息</cite></a>
              </span>
    <a class="layui-btn layui-btn-small" style="line-height:1.6em;margin-top:3px;float:right"
       onclick="location.reload()" title="刷新">
        <i class="layui-icon layui-icon-refresh" style="line-height:30px"></i></a>
</div>
<div class="layui-fluid">
    <div class="layui-row layui-col-space15">
        <div class="layui-col-md12">
            <div class="layui-card">
                <div class="layui-card-body " style="width:1240px ; height:550px;overflow-x: auto; overflow-y: auto; ">
                    <h2 style="font-weight: bolder; margin-left: 30px; margin-top: 30px; margin-bottom: 30px">个人信息</h2>
                    <table class="altrowstable" id="alternatecolor">
                        <tr>
                            <th>员工编号</th>
                            <th>部门</th>
                            <th>职位</th>
                            <th>姓名</th>
                            <th>性别</th>
                            <th>状态</th>
                            <th>入职时间</th>
                            <th>证件类型</th>
                            <th>证件号</th>
                        </tr>
                        <tr th:each="EmployeesInfo:${list}">
                            <td th:text="${EmployeesInfo.EMP_ID}"></td>
                            <td th:text="${EmployeesInfo.DEPT_ID}"></td>
                            <td th:text="${EmployeesInfo.POST_ID}"></td>
                            <td th:text="${EmployeesInfo.EMP_NAME}"></td>
                            <td th:text="${EmployeesInfo.EMP_SEX}"></td>
                            <td th:text="${EmployeesInfo.EMP_STATE}"></td>
                            <td th:text="${EmployeesInfo.EMP_ENTRY_TIME}"></td>
                            <td th:text="${EmployeesInfo.EMP_IDENTIFY_TYPE}"></td>
                            <td th:text="${EmployeesInfo.EMP_IDENTIFY_NUMBER}"></td>

                        </tr>
                        <tr>
                            <th>电话号</th>
                            <th>邮箱</th>
                            <th>民族</th>
                            <th>籍贯</th>
                            <th>出生日期</th>
                            <th>现住址</th>
                            <th>学历</th>
                            <th>入职渠道</th>
                            <th>毕业院校</th>
                        </tr>
                        <tr th:each="EmployeesInfo:${list}">
                            <td th:text="${EmployeesInfo.EMP_PHONE_NUMBER}"></td>
                            <td th:text="${EmployeesInfo.EMP_E_MAIL}"></td>
                            <td th:text="${EmployeesInfo.EMP_NATION}"></td>
                            <td th:text="${EmployeesInfo.EMP_NATIVE_PLACE}"></td>
                            <td th:text="${EmployeesInfo.EMP_BIRTHDAY}"></td>
                            <td th:text="${EmployeesInfo.EMP_LOCATION}"></td>
                            <td th:text="${EmployeesInfo.EMP_EDU_BGD}"></td>
                            <td th:text="${EmployeesInfo.EMP_ENTRY_WAY}"></td>
                            <td th:text="${EmployeesInfo.EMP_EDU_SCHOOL}"></td>
                            <button id="but_1" type="button" class="layui-btn layui-btn-normal"
                                    th:onclick="edit([[${EmployeesInfo.EMP_ID}]]);">编辑信息
                            </button>
                            <button id="but_2" type="button" class="layui-btn layui-btn-normal"
                                    th:onclick="change([[${EmployeesInfo.EMP_ID}]]);">更改密码
                            </button>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="layui-row" id="popSearchRoleTest" style="display:none;">
    <div class="layui-col-md11">

        <form class="layui-form" id="filed">
            <div class="layui-form-item">
                <label class="layui-form-label">
                    <span class="x-red">*</span>手机
                </label>
                <div class="layui-input-inline">
                    <input type="text" id="phnoe_number" name="phnoe_number">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">
                    <span class="x-red">*</span>邮箱
                </label>
                <div class="layui-input-inline">
                    <input type="text" id="L_email" name="email">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">
                    <span class="x-red">*</span>现住址
                </label>
                <div class="layui-input-inline">
                    <input type="text" id="emp_location" name="location">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">
                </label>
                <!--                <button  class="layui-btn"  th:onclick="editSubmit()">-->
                <!--                    确认更改-->
                <!--                </button>-->
                <button class="layui-btn" lay-submit lay-filter="modify">确认更改</button>
            </div>
        </form>

    </div>
</div>
<div class="layui-row" id="ChangePassword" style="display:none;">
    <div class="layui-col-md11">
        <form class="layui-form" id="change">
            <div class="layui-form-item">
                <label class="layui-form-label">
                    <span class="x-red">*</span>账户
                </label>
                <div class="layui-input-inline">
                    <input type="text" id="name" name="name">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">
                    <span class="x-red">*</span>旧密码
                </label>
                <div class="layui-input-inline">
                    <input type="password" id="oldpassword" name="oldpassword">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">
                    <span class="x-red">*</span>新密码
                </label>
                <div class="layui-input-inline">
                    <input type="password" id="newpassword" name="newpassword">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">
                    <span class="x-red">*</span>再次输入
                </label>
                <div class="layui-input-inline">
                    <input type="password" id="again" name="again">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">
                </label>
                <button class="layui-btn" lay-submit lay-filter="modify_1">确认更改</button>
            </div>
        </form>
    </div>
</div>
</body>
<script>
    var edit;
    // 回显数据
    function edit(id) {

        layui.use('layer', function () {
            var layer = layui.layer;
            edit = layer.open({
                type: 1,
                title: "编辑个人信息",
                shade: 0.3,
                content: $("#popSearchRoleTest").html(),
                area: ['500px', '300px'],
            });
            $.ajax({
                cache: false,
                url: '/self/findSelfByEMP_ID',
                type: 'POST',
                dataType: 'json',
                data: {
                    'EMP_ID': id
                },
                success: function (employeesInfo) {
                    $("[name='phnoe_number']").val(employeesInfo.EMP_PHONE_NUMBER);
                    $("[name='email']").val(employeesInfo.EMP_E_MAIL);
                    $("[name='location']").val(employeesInfo.EMP_LOCATION);
                }
            })
        });
    }

    layui.use(['layer', 'form', 'jquery'], function () {
        var layer = layui.layer,
            form = layui.form,
            $ = layui.$;
        form.on('submit(modify)', function (data) {
            console.log(JSON.stringify(data.field));
            $.ajax({
                type: "post",
                url: "/self/editUser",
                async: true,
                contentType: 'application/json',
                dataType: 'JSON',
                data: JSON.stringify(data.field),//将对象转为json字符串
            });
            layer.close(edit)
            layer.msg("更改成功，刷新试试！")
            return false;
        });
    });
    var layerChangePassword;
    // 更改密码
    function change(id) {
        layui.use('layer', function () {
            var layer = layui.layer;
            layerChangePassword = layer.open({
                type: 1,
                title: "更改密码",
                shade: 0.3,
                content: $("#ChangePassword").html(),
                area: ['600px', '400px'],

            });
            $.ajax({
                cache: false,
                url: '/self/findAccountByEMP_ID',
                type: 'POST',
                dataType: 'json',
                data: {
                    'EMP_ID': id,
                },
                success: function (empAccount) {
                    // $("[name='name']").val(empAccount.emp_id);
                    // $("[name='oldpassword']").val(empAccount.emp_password);
                }
            })
        });
    }

    layui.use(['layer', 'form', 'jquery'], function () {
        var layer = layui.layer,
            form = layui.form,
            $ = layui.$;
        form.on('submit(modify_1)', function (data) {
            console.log(JSON.stringify(data.field));
            $.ajax({
                type: "post",
                url: "/self/updatePassword",
                contentType: 'application/json',
                dataType: 'JSON',
                data: JSON.stringify(data.field),//将对象转为json字符串
                success: function (res) {
                    if (res.code === 200){
                        layer.close(layerChangePassword),
                            layer.msg('更改成功');
                    }else{
                        layer.msg('密码不一致');
                    }
                }
            });
            return false;
        });
        layer.closeAll();
    });

</script>
</html>



